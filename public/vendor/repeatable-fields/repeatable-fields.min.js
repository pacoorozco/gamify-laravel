!function(t){"use strict";t.fn.repeatable_fields=function(e){var i=this;return i.after_add=function(e,n){var s=t(e).attr("data-rf-row-count");s++,t("*",n).each(function(){t.each(this.attributes,function(){this.value=this.value.replace(i.settings.row_count_placeholder,s-1)})}),t(e).attr("data-rf-row-count",s)},i.default_settings={wrapper:".wrapper",container:".container",row:".row",add:".add",remove:".remove",move:".move",move_up:".move-up",move_down:".move-down",move_steps:".move-steps",template:".template",is_sortable:!0,before_add:null,after_add:i.after_add,before_remove:null,after_remove:null,sortable_options:null,row_count_placeholder:"{{row-count-placeholder}}"},i.settings=t.extend({},i.default_settings,e),i.initialize=function(e){t(i.settings.wrapper,e).each(function(){var e=t(this).children(i.settings.container);t(e).children(i.settings.template).hide().find(":input").each(function(){t(this).prop("disabled",!0)});var n=t(e).children(i.settings.row).filter(function(){return!t(this).hasClass(i.settings.template.replace(".",""))}).length;if(t(e).attr("data-rf-row-count",n),t(this).on("click",i.settings.add,function(n){n.stopImmediatePropagation();var s=t(t(e).children(i.settings.template).clone().removeClass(i.settings.template.replace(".",""))[0].outerHTML);t(s).find(":input").each(function(){t(this).prop("disabled",!1)}),"function"==typeof i.settings.before_add&&i.settings.before_add(e);var o=t(s).show().appendTo(e);"function"==typeof i.settings.after_add&&i.settings.after_add(e,o,i.settings.after_add),i.initialize(o)}),t(this).on("click",i.settings.remove,function(n){n.stopImmediatePropagation();var s=t(this).parents(i.settings.row).first();"function"==typeof i.settings.before_remove&&i.settings.before_remove(e,s),s.remove(),"function"==typeof i.settings.after_remove&&i.settings.after_remove(e)}),!0===i.settings.is_sortable){if(void 0!==t.ui&&void 0!==t.ui.sortable){var s=null!==i.settings.sortable_options?i.settings.sortable_options:{};s.handle=i.settings.move,t(this).find(i.settings.container).sortable(s)}t(this).find(i.settings.container).on("click",function(e){if(t(e.target).is(i.settings.move_up)||t(e.target).is(i.settings.move_down)){var n=1;if(1===t(e.target).siblings(i.settings.move_steps).length){var s=parseInt(t(e.target).siblings(i.settings.move_steps).val(),10);!1===isNaN(s)&&(s>0||-1===s)&&(n=s)}var o=t(e.target).closest(i.settings.row),r=0;if(!0===t(e.target).is(i.settings.move_up)){var a;for(r=0;-1===n||r<n;r++)if(void 0===a){if(1!==o.prev().not(i.settings.template).length)break;a=o.prev()}else{if(1!==a.prev().not(i.settings.template).length)break;a=a.prev()}void 0!==a&&a.before(o)}else if(!0===t(e.target).is(i.settings.move_down)){var l;for(r=0;-1===n||r<n;r++)if(void 0===l){if(1!==o.next().length)break;l=o.next()}else{if(1!==l.next().length)break;l=l.next()}void 0!==l&&l.after(o)}e.stopImmediatePropagation()}})}})},i.initialize(i),i}}(jQuery);
