!function(e){"use strict";e.fn.repeatable_fields=function(t){var i=this;return i.after_add=function(t,n){var s=e(t).attr("data-rf-row-count");s++,e("*",n).each((function(){e.each(this.attributes,(function(){this.value=this.value.replace(i.settings.row_count_placeholder,s-1)}))})),e(t).attr("data-rf-row-count",s)},i.default_settings={wrapper:".wrapper",container:".container",row:".row",add:".add",remove:".remove",move:".move",move_up:".move-up",move_down:".move-down",move_steps:".move-steps",template:".template",is_sortable:!0,before_add:null,after_add:i.after_add,before_remove:null,after_remove:null,sortable_options:null,row_count_placeholder:"{{row-count-placeholder}}"},i.settings=e.extend({},i.default_settings,t),i.initialize=function(t){e(i.settings.wrapper,t).each((function(){var t=this,n=e(t).children(i.settings.container);e(n).children(i.settings.template).hide().find(":input").each((function(){e(this).prop("disabled",!0)}));var s=e(n).children(i.settings.row).filter((function(){return!e(this).hasClass(i.settings.template.replace(".",""))})).length;if(e(n).attr("data-rf-row-count",s),e(t).on("click",i.settings.add,(function(t){t.stopImmediatePropagation();var s=e(e(n).children(i.settings.template).clone().removeClass(i.settings.template.replace(".",""))[0].outerHTML);e(s).find(":input").each((function(){e(this).prop("disabled",!1)})),"function"==typeof i.settings.before_add&&i.settings.before_add(n);var o=e(s).show().appendTo(n);"function"==typeof i.settings.after_add&&i.settings.after_add(n,o,i.settings.after_add),i.initialize(o)})),e(t).on("click",i.settings.remove,(function(t){t.stopImmediatePropagation();var s=e(this).parents(i.settings.row).first();"function"==typeof i.settings.before_remove&&i.settings.before_remove(n,s),s.remove(),"function"==typeof i.settings.after_remove&&i.settings.after_remove(n)})),!0===i.settings.is_sortable){if(void 0!==e.ui&&void 0!==e.ui.sortable){var o=null!==i.settings.sortable_options?i.settings.sortable_options:{};o.handle=i.settings.move,e(t).find(i.settings.container).sortable(o)}e(t).find(i.settings.container).on("click",(function(t){if(e(t.target).is(i.settings.move_up)||e(t.target).is(i.settings.move_down)){var n=1;if(1===e(t.target).siblings(i.settings.move_steps).length){var s=parseInt(e(t.target).siblings(i.settings.move_steps).val(),10);!1===isNaN(s)&&(s>0||-1===s)&&(n=s)}var o=e(t.target).closest(i.settings.row),r=0;if(!0===e(t.target).is(i.settings.move_up)){var a;for(r=0;-1===n||r<n;r++)if(void 0===a){if(1!==o.prev().not(i.settings.template).length)break;a=o.prev()}else{if(1!==a.prev().not(i.settings.template).length)break;a=a.prev()}void 0!==a&&a.before(o)}else if(!0===e(t.target).is(i.settings.move_down)){var l;for(r=0;-1===n||r<n;r++)if(void 0===l){if(1!==o.next().length)break;l=o.next()}else{if(1!==l.next().length)break;l=l.next()}void 0!==l&&l.after(o)}t.stopImmediatePropagation()}}))}}))},i.initialize(i),i}}(jQuery);
